# HW04 – eda-cli: базовый EDA с HTTP-сервисом

Небольшое CLI-приложение для базового **EDA** с HTTP-сервисом.

Приложение позволяет:
- получить краткий обзор датасета;
- посмотреть статистику по колонкам и пропускам;
- оценить качество данных с помощью простых эвристик;
- сгенерировать табличный и визуальный EDA-отчёт;
- предоставить HTTP API для оценки качества датасетов;
- проверять качество данных по CSV-файлу через веб-сервис.

---

## Требования

- Python **3.11+**
- установленный инструмент **[uv](https://docs.astral.sh/uv/)**

---

## Инициализация проекта

Перейдите в папку проекта (внутри `homeworks/HW04/eda-cli`) и выполните:

```bash
uv sync
```

Команда:

- создаст виртуальное окружение `.venv`;
- установит зависимости из `pyproject.toml`;
- установит CLI-приложение `eda-cli` в окружение.

---

## Запуск CLI

CLI-приложение содержит две основные команды:

- `overview` — краткий обзор датасета;
- `report` — генерация полного EDA-отчёта.

Посмотреть справку по CLI:

```bash
uv run eda-cli --help
```

---

## Команда `overview`

Выводит краткий обзор CSV-файла:

- количество строк и столбцов;
- типы данных;
- число пропусков;
- количество уникальных значений по колонкам.

### Пример запуска

```bash
uv run eda-cli overview data/example.csv
```

### Параметры

- `--sep` — разделитель в CSV (по умолчанию `,`);
- `--encoding` — кодировка файла (по умолчанию `utf-8`).

---

## Команда `report`

Генерирует **полный EDA-отчёт**, включающий таблицы, эвристики качества и визуализации.

### Базовый пример

```bash
uv run eda-cli report data/example.csv --out-dir reports_example
```

---

### Дополнительные параметры команды `report`

| Параметр                | Описание                                                  |
| ----------------------- | --------------------------------------------------------- |
| `--out-dir`             | Каталог для сохранения отчёта                             |
| `--max-hist-columns`    | Максимальное число числовых колонок для гистограмм        |
| `--top-k-categories`    | Сколько top-значений сохранять для категориальных колонок |
| `--title`               | Заголовок Markdown-отчёта                                 |
| `--json-summary`        | Сохранить компактную JSON-сводку датасета                 |
| `--min-quality-score`   | Минимально допустимое значение quality_score (0–1)        |
| `--fail-on-low-quality` | Завершить команду с ошибкой, если качество ниже порога    |


### Пример запуска с дополнительными опциями

```bash
uv run eda-cli report data/example.csv --out-dir reports_example --top-k-categories 3 --title "EDA отчёт по example.csv" --json-summary
```

---

## Что создаётся в каталоге отчёта

После выполнения команды `report` в указанной папке появляются следующие файлы:

- `report.md` — основной отчёт в формате Markdown;
- `summary.csv` — таблица со сводной информацией по колонкам;
- `missing.csv` — статистика пропусков по колонкам;
- `correlation.csv` — корреляционная матрица числовых признаков (если применимо);
- `summary.json` — JSON-сводка датасета (при использовании `--json-summary`);
- `top_categories/*.csv` — top-k значений категориальных признаков;
- `hist_*.png` — гистограммы числовых колонок;
- `missing_matrix.png` — визуализация пропусков;
- `correlation_heatmap.png` — тепловая карта корреляций.

---

## Эвристики качества данных

В рамках HW03 были добавлены дополнительные эвристики качества данных, включая:

- слишком малое количество строк;
- слишком большое количество колонок;
- высокая доля пропусков;
- наличие константных колонок;
- подозрительно большое количество нулевых значений в числовых признаках.

На основе этих эвристик рассчитывается интегральный показатель
**`quality_score`** в диапазоне от 0 до 1.

---

## Тесты

Проект покрыт минимальными тестами для проверки логики анализа данных.

Запуск тестов:

```bash
uv run pytest -q
```

### Контроль качества данных

Команда `report` поддерживает режим строгой проверки качества данных.

При использовании параметров:

- `--min-quality-score`
- `--fail-on-low-quality`

CLI завершится с кодом ошибки, если интегральный показатель
`quality_score` окажется ниже заданного порога.

```bash
uv run eda-cli report data/example.csv --fail-on-low-quality --min-quality-score 0.8
```

## HTTP-сервис

### Запуск HTTP-сервиса

Для запуска сервиса используйте `uvicorn`:

```bash
uv run uvicorn eda_cli.api:app --reload --port 8000
```

### Доступные эндпоинты:

- `GET /health` — проверка состояния сервиса;
- `POST /quality` — оценка качества по агрегированным признакам;
- `POST /quality-from-csv` — оценка качества по CSV-файлу с использованием EDA-ядра;
- `POST /quality-flags-from-csv` — возврат полного набора булевых флагов качества данных,
  рассчитанных EDA-ядром (включая эвристики из HW03).

### Логирование

HTTP-сервис использует структурированное логирование запросов в формате JSON
(эндпоинт, latency, request_id, временная метка), выводимое в стандартный поток.
